---
layout: post
title: "看电影学算法：Facemash 排名算法"
category: technium
tags: [algorithm, movie, facemash]

---



还记得电影 Social Network 中那个有名的数学公式么？Mark Zuckerberg 用它来为哈佛大学的女生的长相排名。


根据电影的剧情，Mark 问 Eduardo 要来了那个公式：


* **Mark:** I need the algorithm you use to rank chess players.<br />我需要你用来给象棋选手排名用的算法。坑爹的字幕组居然翻译成了：投机石油……
* **Eduardo:** Are you ok?<br />你没事吧？
* **Mark:** We're ranking girls.<br />我们在给女孩们排序。


接着 Eduardo 就在窗户上写下这个公式。


![algorithm](http://ww1.sinaimg.cn/mw600/534218ffgw1dt75u5ujomj.jpg)


* **Eduardo:** Each girl base rating 1400. At any given time "Girl A" has a rating R-a and "Girl B" has a rating R-b.<br /> 每个女生有 1400 的基础分。在某一时刻，女孩 A 的分数为 Ra，女孩 B 的分数为 Rb。
* **Mark:** When any 2 girls are matched up, there's an expectation of which will win based on their current rating, right?<br />当两个女生进行比较的时候，他们（获胜）的数学期望要根据他们当前的分数计算，对不？
* **Eduardo:** Yeah. And those expectations are express this way. <br />没错，就是用这个公式算出来的。


然后 Mark 就开始劈里啪啦敲击键盘了。


看到这里喜欢尝鲜的你说不定已经迫不及待地想要实现这个算法了，如果没有，也没关系，因为电影中给出的公式根本就是错的，除号下面的式子应该是 $1+10^{\frac{R_b-R_a}{400}}$
，而不是 $1+{10}{\frac{R_b-R_a}{400}}$，我们都被导演忽悠了……而且算出双方获胜的数学期望只是算法的第一步。


假设屏幕上出现了两个女孩，左边是 a，右边是 b。女孩 a 当前的得分是 1700，女孩 b 的得分为 1000。如果我把票投给了 a，那么 a 的得分 Sa = 1， b 就只能苦吞败果，得分 Sb = 0。（同样地，如果我把票投给 b， Sa 就等于0，Sb 等于 1；如果我选择了“Niether of these”，双方各得 0.5 分，Sa = Sb = 0.5。）


如果我们采用最普通的算法，那么女孩 a 的分数应该更新为 Ra' = Ra + Sa = 1700 + 1 = 1701。而女孩 b 的分数则保持 1000 不变。


但是这种 Naive 算法的不足在于它会让美女们的比拼变得不那么不激烈，试想一个美女因为在一群普通人身上赚到了足够多的积分，从而在排名榜上遥遥领先。同时，一个人战胜强敌和击败弱旅得到的分数是相等，这是不公平的！


于是我们引入了“x 应该赢得比赛的期望 Ex”这个概念：


$$
E_a = \frac{1}{1+10^{\frac{Rb-Ra}{400}}} = \frac{1}{1+10^{\frac{1000-1700}{400}}} = 0.9825
$$ 

赛前预测，具有更高的赢面。

$$
E_b = \frac{1}{1+10^{\frac{Ra-Rb}{400}}} = \frac{1}{1+10^{\frac{1700-1000}{400}}} = 0.0174
$$

很有可能会输！


并用它们对最后得分进行修正，修正的公式为 K(Sa - Ea)，K 是一个影响因子，这里我们取 1：


* 如果 a 赢了 b：a 的得分为 1 - 0.9825 = 0.0174，所谓赢了也不露脸；b 的得分为 0 - 0.0174 = -0.0174，意料之中的失利，抖一抖身上的土下次再来。
* 如果 a 和 b 打平：a 的得分为 0.5 - 0.9825 = -0.4825，走了背运了；b 的得分为 0.5 - 0.0174 = 0.4926，所谓没输就是赢。
* 如果 a 输给了 b：a 的得分为 0 - 0.9825 = -0.9825，这次丢人丢大了；b 的得分为 1 - 0.0174 = 0.9926，。


这个算法被广泛地运用在了各项棋类赛事中，人称 ELO 等级分制度（[Elo rating system](http://en.wikipedia.org/wiki/Elo_rating_system)）。


该模型假设参赛比赛的选手的表现和他们的实力符合 [logistic distribution](http://en.wikipedia.org/wiki/Logistic_distribution) （如下图），如果你的实际表现低于预期就必须要为此付出“相应”（由 K 决定）的代价。


![line](/images/facemash.png)


值得注意的是，这是一种统计学上的方法。由于没有过往的数据作支撑，Zuckerberg 的“拿来主义”是对是错还需要讨论。


