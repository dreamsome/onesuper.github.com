---
layout: post
title: "特征选择与卡方检验"
category: technium
tags: []
latex: true
---


卡方其实是 chi-square 的意思，即 chi 的平方，其中 chi 是希腊字母 $\chi$（不是英文字母里的 /eks/），关于它的读法历来分成两派，一个念 /kai/ 一个读 /ka/，即开方分布和卡方检验的区别。但事实上这两种读法都不准确，希腊字母中 /x/ 的发音其实和普通话里的“呵”是一样的，就像，$\TeX$ 和 $\LaTeX$ 应该读成“太呵”和“拉太呵”。


$\chi^2$ 检验是一种假设检验的方法，打个比方我们假设“穿裙子的都是女人”，理性主义者肯定会说“穿裙子的可不都是女人嘛？”，但是统计学家必须亲自上街看看去，而这个过程就是样本采集。如果路上遇到的 100 个穿裙子的人中 99 个是女性，这个时候我们就接受原假设，认为“在这个世界上穿裙子的都是女人”，而那 1% 就当成是偶然情况或者因为测量方式不够精确导致的，比如她的确是个女生，但是因为长得太磕碜，我们给看成男的了。相反如果我们来到一个国家（比如苏格兰）发现路上碰到的 100 个穿裙子的人中有15个是男性，我们就能有充分的理由（偏差过大）怀疑原假设的正确性了，于是我们接受与原假设对立的假设，即“穿裙子的不都是女人”。（注意原命题的否命题并非“穿裙子的都是男人”，否则那个国家的男性就被一棍子打死了:D）


$\chi^2$ 统计量早在 1900 年就由英国科学家 Pearson 提出，其公式为

$$
\chi^2 = \displaystyle\sum_{i=1}^{n}(X_i - E)^2
$$

其中 $X_i$ 表示观察到的频数，E 是期望频数，即理论值。当观察值与理论值越接近，两者的差也就越小，$\chi^2$ 也就越低，一种理想情况是 $X_i$ 每次都等于 E，$\chi^2$ 为 0，表明理论成立。假设一个月连续 30 天都到大街上溜达，每天遇到的 100 个穿裙子的人全部都是小姑娘，那么我就可以放心地接受“穿裙子的都是女人”这个假设了。但在实验的过程中不可能没有一点干扰，所以只要 $\chi^2$ 值不是很大（小于阈值），我们就接受假设，但是一旦高于阈值，我们就只能推翻假设了。因此我们说 $\chi^2$ 统计量反映的其实是理论偏离实际的程度。


在计算“$X_i$ 偏离 E 的程度”的时候不能让它们的差值正负相消，因此要像方差那样求一个平方和。另外，要除以一个 E 是因为“$X_i$ 偏离 E 的程度”应该是一个相对的量，试想一下期望中 500 万的大奖，但结果却中了 5000 元的小奖（偏差 99.99%）和想中个 100 元就不错了结果中了 50 元（偏差 50%）相比哪个心里落差更大。因为 $\chi^2$ 是个求和公式，它的大小还与 n 的大小有关，与自由度大小也有关系，林子大了什么样的鸟都有，当“穿裙子的人”达到一定数量，总会发现有那么几个是男的。


### 特征向量


在文本分类时我们用分词或 N-gram 的方法将每一篇文章抽象成特征向量的形式。比如 IT 新闻“当当网北京时间 12 月 8 日晚将在纽交所挂牌上市，发行价 16 美元，融资 2.72 亿美元……”就可以表示成关键字（term）向量：


(当当网/5， 北京/2， 时间/2， 纽交所/1， 挂牌/1， 上市/3， 发行价/1， 美元/8， 融资/2， 亿/8……)


“/数字”表示这个词在这篇文章中出现的频数。这个向量的维度理论上和词典的词条数量是一样的，最新一版《现代汉语词典》的字、词、成语、熟语的数量约为 65000，即使用 1 元组的方式分割，根据国标一级的 8000 字标准，特征向量至少也是 8000 维，其中很多生僻字出现的频度都是 0， 将它们一股脑儿都加到特征向量中非但对分类没有任何帮助，徒增计算的复杂度。


这些词中“美元”、“发行价”、“上市”有可能出现在“财经”类的文本中，而“北京”、”时间“这些词更是会在各领域的文档中频繁出现，因此在选择特征向量时要排除它们。可能有人要问在这条新闻中出现了很多次的”当当网“能否作为特征词？也不可以，因为”当当网“可能只集中出现在这一篇文章中，而在IT类的其它文本中一次都没出现，文本分类的特征绝不能以偏概全。小明是个“三好学生”，而且小明十分爱干净，但我们不能把“爱干净”作为“三好学生”的指标拿去衡量所有“三好学生”。相反如果所有“三好学生”身上都有一个共同特征，而且所有“非三好学生”身上恰好又都没有，我们就可以用它作为“三好学生”的特征，比如所有三好学生的成绩还过得去。

理想情况下一个词汇只要满足在某一个类别中的每篇文章都出现，而在其他类别中几乎不出现，我们称它为“好的”或者说“具有标志性"的词汇，那么挑选它们作为特征就是有意义的。比如对 IT 类来说是“互联网”、“云计算”这样的词，对体育类来讲就是“比赛”、“足球”、“冠军”。那么怎样量化词汇和类别之间的相关性呢？一种方法就是用前面说过的 $\chi^2$ 检验（$\chi^2$ 检验常用于检验两个随机变量的独立性）。


现在又回到 $\chi^2$ 检验，刚刚说过假设检验的目的是为了证明或者证伪某些假设，而特征选择时我们想要了解的是一个词汇和某一分类的关联性。故我们作出的假设要么是“词汇 ti 和分类 cj 相关”，要么就是“词汇 ti 和分类 cj 不相关”。实际中采取后面那种假设更好，因为我们的目的并不是真的要去了解某个词汇和某个类之间到底有没有千丝万缕的联系，而是要找出那些与某一类别“关系更紧密”的词汇，然后用它们做为该类的特征。因此从量化的角度看假设“词汇 ti 和分类 cj 相关”时，所有我们关心的“电脑”、“互联网”、“云计算”这些词的 $\chi^2$ 值都徘徊在 0 的附近（因为关系密切，偏差度自然就比较小），数量一多就不容易比较。相反，如果假设“词汇 ti 和分类 cj 不相关“，这些适合拿来做特征的词的 Х2 值就会很大，区分度也就大了。

### 列联表

下面介绍一种用 2 乘 2 列联表（contingency table）考察词汇和类别的相关性的方法。为了简化问题，我们先假设所有文本只分成“IT 类”和非“IT 类”（事实上把芸芸众“文”强行分成十几个类别，本身就是一种简化），两类文本各有 100 篇文章用于提取特征。


首先来看“云计算”这个词，假设它和“IT”类不相关，这意味着“一个文档是否属于IT 类”与“文档中是否出现云计算”这两个事件是独立的，根据两个随机变量的联合概率等于其边缘概论乘积的性质，我们得到:


既出现云计算且属于 IT 类的概率 = 出现云计算的概率 × 属于 IT 类的概率


其中“属于 IT 类的概率”是一开始就知道的，为 0.5（200 篇文章 100 篇为 IT 类），而“出现云计算的概率”要对 200 篇文章进行统计以后才知道，假设有 20 篇出现了“云计算”。那么概率就等于 0.1。因此理论上<strong>既出现云计算且属于 IT 类</strong>的文档应该有 0.1 × 0.5 × 200 = 10（篇）。

同理，<strong>没有出现云计算但属于 IT 类</strong>的有 0.9 × 0.5 × 200 = 90

<strong>出现云计算但不属于 IT 类</strong>的有 0.1 × 0.5 × 200 = 10

<strong>既没有出现云计算且不属于 IT 类</strong>的有 0.9 × 0.5 × 200 = 90

将其表示为列联表的形式：


<table class="table">
<tbody>
<tr>
<td class="td1">理论值</td>
<td class="td1">属于 IT 类的文档数</td>
<td class="td1">不属于 IT 类的文档数</td>
</tr>
<tr>
<td class="td1">出现“云计算”的文档数</td>
<td class="td1">10</td>
<td class="td1">10</td>
</tr>
<tr>
<td class="td1">没出现“云计算”的文档数</td>
<td class="td1">90</td>
<td class="td1">90</td>
</tr>
</tbody>
</table>


考虑到“云计算”是IT 行业这两年最热门的名词，实际情况可能是下面的样子的，出现了“云计算”的 20 篇文章全部出自“IT 类”，而100 篇“非 IT 类”的文章一篇都没有提到“云计算”。


<table class="table">
<tbody>
<tr>
<td>实测值</td>
<td>属于 IT 类的文档数</td>
<td>不属于 IT 类的文档数</td>
</tr>
<tr>
<td>出现“云计算”的文档数</td>
<td>20</td>
<td>0</td>
</tr>
<tr>
<td>没出现“云计算”的文档数</td>
<td>80</td>
<td>100</td>
</tr>
</tbody>
</table>


在实际提取特征的时候只需要下面那张表就够了，因为四个变量的理论值可以通过四个实测值来计算出，其背后的原理是列联表行与行（列与列）的频数比值反映了其边缘概率（见下表）。


<table class="table">
<tbody>
<tr>
<td>实测值</td>
<td>属于 IT 类的文档数</td>
<td>不属于 IT 类的文档数</td>
<td></td>
</tr>
<tr>
<td>出现“云计算”的文档数</td>
<td>20</td>
<td>0</td>
<td>20</td>
</tr>
<tr>
<td>没出现“云计算”的文档数</td>
<td>80</td>
<td>100</td>
<td>80</td>
</tr>
</tbody>
</table>


理论和实验的偏差度 $\chi^2$ = (20-10)^2/10 + (0-10)^2/10 + (80 - 90)^2/90 + (80 - 90)^2/90 = 22.22222...

这个值越大表示“IT”和和“云计算”的相关性越大，用“云计算”做“IT 类”特征向量的可能性也越大。因为缺少比较，再举一个“当当网”的例子


<table class="table">
<tbody>
<tr>
<td>实测值</td>
<td>属于 IT 类的文档数</td>
<td>不属于 IT 类的文档数</td>
<td></td>
</tr>
<tr>
<td>出现“当当网”的文档数</td>
<td>2</td>
<td>0</td>
<td>2</td>
</tr>
<tr>
<td>没出现“当当网”的文档数</td>
<td>98</td>
<td>100</td>
<td>198</td>
</tr>
<tr>
<td></td>
<td>100</td>
<td>100</td>
<td></td>
</tr>
</tbody>
</table>


<table class="table">
<tbody>
<tr>
<td>理论值</td>
<td>属于 IT 类的文档数</td>
<td>不属于 IT 类的文档数</td>
<td></td>
</tr>
<tr>
<td>出现“当当网”的文档数</td>
<td>1</td>
<td>1</td>
<td>2</td>
</tr>
<tr>
<td>没出现“当当网”的文档数</td>
<td>99</td>
<td>99</td>
<td>198</td>
</tr>
<tr>
<td></td>
<td>100</td>
<td>100</td>
<td></td>
</tr>
</tbody>
</table>


$\chi^2$ = (2-1)^2/2 + (1-0)^2/1 + (99-98)^2/99 +(99-100)^2/99 = 2.0101...


显然它与“IT”的相关性与“云计算”相比小多了。
